---
lang: zh-CN
title: 定时器
description: sup 10
---


理论基础：

>堆是一种非线性结构，可以把堆看作一个数组，也可以被看作一个完全二叉树，通俗来讲堆其实就是利用完全二叉树的结构来维护的一维数组。  
  按照堆的特点可以把堆分为**大顶堆**和**小顶堆**：  
	大顶堆：每个结点的值都**大于**或**等于**其左右孩子结点的值， 根节点最大；  
	小顶堆：每个结点的值都**小于**或**等于**其左右孩子结点的值，根节点最小。  



时间轮算法：通过一个时间轮去维护定时任务，按照一定的时间单位对时间轮进行划分刻度。一种实现定时任务的方法。

#### JDK定时器Timer

  Timer是一个定时器工具，用来执行指定的任务

  TimerTask: 抽象类

  delay(开始执行的等待时间)

  Timer是一种工具，线程用其安排以后在后台线程中执行的任务。可安排任务执行一次，或者定期重复执行。实际上是个线程，定时调度所拥有的TimerTasks。

TimerTask是一个抽象类，它的子类由 Timer 安排为一次执行或重复执行的任务。实际上就是一个拥有run方法的类，需要定时执行的代码放到run方法体内。



```Java
package com.xxx.test1;

import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.util.TimerTask;

public class MyTimerTask extends TimerTask {

    private int num = 1;

    @Override
    public void run() {
        try {
            BufferedWriter bw = new BufferedWriter(new FileWriter("1.txt"));
            bw.write(num+"");
            num++;
            bw.flush();
            bw.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

```


```Java
package com.xxx.test1;

import java.util.Timer;

public class Exe {
    public static void main(String[] args) {

        Timer timer = new Timer();
        MyTimerTask task = new MyTimerTask();

        timer.schedule(task,1000,1000);

        try {
            Thread.sleep(2000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}

```



#### 定时任务线程池
指放入线程池的任务，可以按照指定的等待周期循环执行。

Java里面`ScheduledThreadPoolExecutor`这个类实现了这种功能。
Spring里面的定时任务也是在`ScheduledThreadPoolExecutor`的基础上扩展而来。



#### 定时任务框架-quartz
是一个开源项目，完全由Java开发，可以用来执行定时任务，类似于java.util.Timer。但是相较于Timer， Quartz增加了很多功能：

- 持久性作业 - 就是保持调度定时的状态;
- 作业管理 - 对调度作业进行有效的管理;

**Quartz的基本组成部分：**

- 调度器：Scheduler
- 任务：JobDetail
- 触发器：Trigger，包括SimpleTrigger和CronTrigger