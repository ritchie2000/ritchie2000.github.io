---
title: 消息中间件
---
**1 消息队列是什么**
首先是队列，一组用来通信的组件。
常用的有RocketMQ 、Kafka、RabbitMQ、ActiveMQ

RabbitMQ支持多语言，效率最高微秒级、方案成熟、遵循AMQP高级消息队列协议）协议、学习简单。

*RabbitMQ VS Kafaka*
R：更高的灵活性和信息安全性，吞吐量小、可靠性高、严谨、数据丢失可能性小，金融场景常用
K：吞吐量高、大数据处理、不够严谨、数据重复发送、放弃了部分安全性

**2 作用**
传递消息

解耦服务之间的关系，控制资源的使用，缓冲流量洪峰

**3 两种模型**
队列模型：每条消息只能被一个消费者消费
发布/订阅模型：
	- Producer生产者 -> Broker存储消息 -> Consumer消费消息
	- 消息全局有序
	- 消息部分有序
	- 消息堆积处理：生产消费消息的速度不一致

**4 写个中间件**
角色：生产者、消费者、Broker、注册中心
- 注册中心：负责其他3个的发现，下线，可使用的技术有eureka、nacos、zookeeper、consul等。

**5 消息队列设计**
- 默认生产者Producer把消息推送给Broker
- 推模式：Broker把消息推给消费者Consumer
- 拉模式：消费者自己去拉取消息
*Kafka用的是拉模式*，并利用“长轮询”解决消息延迟、消息忙请求的缺点。
长轮询：消费者去 Broker 拉消息，定义了一个超时时间，如果有消息的话马上返回消息，如果没有的话消费者等着直到超时，然后再次发起拉消息请求

*RabbitMQ用的是推模式*：它的“长轮询”方式：Consumer不断轮询请求看是否有新消息，如果有就重新拉取消息，再判断当前时间是否大于hold+请求超时时间，如果是也会重新拉取消息，如果Broker没有消息默认等待5s。

eg.小哥每5分钟去驿站拿快递，快递没到时等待，



**6 几种常见的RabbitMQ消息收发方式**
1. Hello World：一个生产者，一个默认的交换机，一个队列，一个消费者
2. Work queues：一个生产者，一个默认的交换机，一个队列，两个消费者
3. Publish/Subscribe：一个生产者，一个交换机，两个队列，两个消费者
4. Routing：一个生产者，一个交换机，两个队列，两个消费者
5. Topics：一个生产者，一个交换机，两个队列，两个消费者

