---
title: 锁
---
## Java中的锁？
  - 轻量级锁、重量级锁
  - 悲观锁、乐观锁
  - 自旋锁、非自旋锁
  - 公平锁、非公平锁
  - 共享锁、独占锁

### 1、悲观锁、乐观锁
- 悲观锁: 基于数据库层面的锁,每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block阻塞。
- 乐观锁: 每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据。
- 乐观锁比较消耗 cpu 的资源

### 2、公平锁、非公平锁
公平锁：就是比较公平，根据请求锁的顺序排列，先来请求的就先获取锁，后来获取锁就最

后获取到， 采用队列存放 类似于吃饭排队。

非公平锁：不是据请求的顺序排列， 通过争抢的方式获取锁。

非公平锁效率是公平锁效率要高，Synchronized 是非公平锁

### 3、独享锁、共享锁
独占锁：在多线程中，只允许有一个线程获取到锁，其他线程都会等待。

共享锁：多个线程可以同时持有锁，例如 ReentrantLock 读写锁。读读可以共享、写写互斥、读写互斥、写读互斥。

*锁的可重入性* 在同一个线程中锁可以不断传递的，可以直接获取。

### 4、自旋锁CAS
没有获取到锁的线程是不会阻塞的，通过循环控制一直不断的获取锁。
*实现细节：*
CAS 获取锁：
将该锁的状态从 0 改为 1-----能够修改成功 cas 成功则表示获取锁成功
如果获取锁失败--修改失败，则不会阻塞而是通过循环（自旋来控制重试）

CAS 释放锁：
将该锁的状态从 1 改为 0 如果能够改成功 cas 成功则表示释放锁成功

**CAS 如何解决 ABA 的问题？**
通过版本号码，对每个变量更新的版本号码做+1


`CAS`是`Compare And Swap`的缩写，直译就是**比较并交换**。本质上来讲CAS是一种无锁的解决方案，也是一种基于乐观锁的操作，可以保证在多线程并发中保障共享资源的原子性操作，相对于synchronized或Lock来说，是一种轻量级的实现方案。